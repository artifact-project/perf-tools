var perfKeeperExtMemory=function(e){"use strict";var n="object"==typeof globalThis&&globalThis||"object"==typeof window&&window||"object"==typeof global&&global||{},t=n.document,i=n.performance;i&&i.now||Date.now;function u(e){"complete"===t.readyState?e():t.addEventListener("DOMContentLoaded",e)}var c=[];function s(o,i,u,s){var a={};return[function(e,n,t,r){var o=a;c.concat(e).forEach(function(e){var n=o.nested||(o.nested={});o=n[e]||(n[e]={name:e})}),null!=o.end?o.end+=t-n:(o.start=n,o.end=t,o.unit=r)},function(e,n,t,r){a.name=e?o+"-"+e:o,a.start=n,a.end=t,function n(e,t){var r,o=e.nested,a=o?Object.keys(o):c;a.length?((r=(t||i).group(e.name,e.start,!t))._=!0,r.unit=u||"ms",(!1===s?a:a.sort()).forEach(function(e){n(o[e],r)}),r.stop(e.end)):t&&(t.add(e.name,e.start,e.end),t.entries[t.entries.length-1].unit=e.unit||t.unit)}(a,null),r&&(a={})}]}var r=6e4,f=[["15sec",15e3],["1min",r],["5min",3e5],["15min",9e5],["30min",18e5],["1hour",36e5],["1day",864e5],["2days",1728e5]];function d(t,e,r){var o=(e||f).slice(0),a=Date.now();return function n(){return new Promise(function(e){e(r(t))}).then(function(){var e=o.shift();e&&(t=e[0],setTimeout(n,Math.max(0,e[1]-(Date.now()-a))))})}()}function o(e,n){void 0===n&&(n={});var t=s(n.groupName||"pk-memory",e,"KiB"),r=t[0],o=t[1];u(function(){d("ready",n.intervals,function(e){var n=i.memory,t=n.totalJSHeapSize;r("total",0,t),r("used",0,n.usedJSHeapSize),r("js",0,n.jsHeapSizeLimit),o(e,0,t,!0)})})}var y={Detached:"detached",JS:"js",Shared:"shared",Window:"window"},l=Array.isArray;function a(o,e){void 0===e&&(e={});var a=e.groupName||"pk-memory",n=s(a,o,"KiB"),f=n[0],m=n[1],p=e.resourceName||h;function t(e,n){var t,r=o.group(a+"-supported",0,!0);r._=!0,r.unit="none",n&&((t=r.group("error",0))._=!0,t.unit="none",t.add("true",0,1),n.name&&t.add(n.name,0,1),t.stop(1)),r.add(""+e,0,1),r.stop(1)}i.measureMemory?u(function(){d("ready",e.intervals,function(c){return i.measureMemory().then(function(e){if(!((n=e)&&0<=n.bytes&&l(n.breakdown)))throw b("PerformanceMeasureMemoryInformation",e);for(var n,t=e.bytes,r=e.breakdown,o=v(f),a=v(f),i=function(n){if(!((e=n)&&0<=e.bytes&&l(e.attribution)&&l(e.userAgentSpecificTypes)))return b("PerformanceMeasureMemoryBreakdown",n),"break";var e;n.userAgentSpecificTypes.forEach(function(e){o.plus(y[e],n.bytes)}),n.attribution.forEach(function(e){a.plus(p(e)||"unknown",n.bytes)})},u=0,s=r;u<s.length;u++){if("break"===i(s[u]))break}o.groupAs("type"),a.groupAs("resource"),f("bytes",0,t,"KiB"),m(c,0,t)})}).then(function(){t(!0)}).catch(function(e){t(!1,e)})}):t(!1)}function h(e){return e.replace(/(^https?:\/*|\/*$)/gi,"").replace(/[^a-z0-9-]/gi,"_")}function v(t){var r={};return{plus:function(e,n){null==r[e]&&(r[e]=0),r[e]+=n},groupAs:function(n){Object.keys(r).forEach(function(e){t([n,e],0,r[e])})}}}function b(e,n){console.warn("[@perf-tools/keeper] Interface '"+e+"' not supported, please report this.",n)}return e.interfaceNotSupportedMsg="interface not supproted",e.measureMemory=a,e.memory=function(e){o(e,{groupName:"pk-memory-stats"}),a(e,{groupName:"pk-memory-measure"})},e.memoryStats=o,e}({});
