<html>
<head>
	<meta charset="utf-8"/>
	<title>TimeKeeper :: Example</title>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132354909-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'UA-132354909-1');
	</script>

	<script id="tk">

		// TimeKeeper
		var timekeeper = (function (exports) {
	'use strict';

	var nil = null;
	var BOLD = 'font-weight: bold;';
	var globalThis = Function('return this')();
	var Date = globalThis.Date;
	var dateNow = Date.now || (function () { return new Date().getTime(); });
	var startOffset = dateNow();
	var nativeConsole = globalThis.console;
	var nativePerf = (globalThis.performance || {});
	var s_group = 'group';
	var s_groupCollapsed = 'groupCollapsed';
	var s_mark = 'mark';
	var s_measure = 'measure';
	var s_clearMarks = 'clearMarks';
	var s_clearMeasures = 'clearMeasures';
	// Polyfill
	nativePerf.now = nativePerf.now
	    || nativePerf.webkitNow
	    || nativePerf.mozNow
	    || nativePerf.msNow
	    || (function () { return (dateNow() - startOffset); });
	function color(ms) {
	    return 'color: #' + (ms < 2 ? 'ccc' :
	        ms < 5 ? '666' :
	            ms < 10 ? '333' :
	                ms < 30 ? 'f90' :
	                    ms < 60 ? 'f60' :
	                        'f00');
	}
	function create(options) {
	    var perf = options.perf || nativePerf;
	    var prefix = options.prefix || '';
	    var console = options.console || nativeConsole;
	    var warn = options.warn || console.warn && console.warn.bind(console);
	    var analytics = options.analytics || [];
	    var needPrint = options.print;
	    var disabled = options.disabled;
	    // Private
	    var perfSupported = !!(options.timeline
	        && perf[s_mark]
	        && perf[s_measure]
	        && perf[s_clearMarks]
	        && perf[s_clearMeasures]);
	    var entries = [];
	    var emitEntries = [];
	    var activeEntries = [];
	    var activeGroups = [];
	    var api;
	    var cid = 0;
	    var lock = false;
	    function disable(state) {
	        disabled = state;
	    }
	    function setAnalytics(list) {
	        var idx = list.length;
	        while (idx--) {
	            var jdx = emitEntries.length;
	            while (jdx--) {
	                list[idx](emitEntries[jdx]);
	            }
	        }
	        analytics = list;
	        emitEntries.length = 0;
	    }
	    function emit(entry) {
	        var idx = analytics.length;
	        if (idx) {
	            while (idx--) {
	                analytics[idx](entry);
	            }
	        }
	        else {
	            emitEntries.unshift(entry);
	        }
	    }
	    function measure(entry) {
	        var id = entry.id;
	        var label = "" + prefix + entry.name;
	        perf[s_measure](label, id);
	        perf[s_clearMarks](id);
	        perf[s_clearMeasures](label);
	    }
	    function __print__(entries) {
	        var i = 0;
	        var total = 0;
	        var start;
	        var entry;
	        var duration;
	        var selfDuration;
	        var logMsg;
	        var nextEntries;
	        var nextLength;
	        for (; i < entries.length; i++) {
	            entry = entries[i];
	            if (entry.end !== nil && !entry.active) {
	                nextEntries = entry.entries;
	                nextLength = nextEntries ? nextEntries.length : 0;
	                start = entry.start;
	                duration = entry.end - start;
	                logMsg = "" + prefix + entry.name + ": %c" + duration.toFixed(3) + "ms";
	                if (nextLength < 1) {
	                    console.log(logMsg, "" + BOLD + color(duration));
	                    total += duration;
	                }
	                else {
	                    console[console[s_groupCollapsed] && nextLength < 2
	                        ? s_groupCollapsed
	                        : s_group](logMsg, color(duration));
	                    selfDuration = duration - __print__(nextEntries);
	                    if (selfDuration > 3) {
	                        emit(createEntry('[[unknown]]', entry, false, start, start + selfDuration));
	                        console.log(prefix + "[[unknown]]: %c" + selfDuration.toFixed(3) + "ms", "" + BOLD + color(selfDuration));
	                    }
	                    total += duration;
	                    console.groupEnd();
	                }
	                if (entry.parent === nil) {
	                    entries.splice(i, 1);
	                    i--;
	                }
	            }
	        }
	        lock = false;
	        return total;
	    }
	    function printDefered() {
	        __print__(entries);
	    }
	    function print(state) {
	        if (state != nil) {
	            needPrint = state;
	        }
	        else if (lock === false) {
	            lock = true;
	            (globalThis.requestAnimationFrame || setTimeout)(printDefered);
	        }
	    }
	    function createEntry(name, parent, isGroup, start, end, isolate) {
	        var label = "" + prefix + name + "-" + ++cid;
	        var id = label + "-mark";
	        if (parent === api) {
	            parent = activeGroups[0] || nil;
	        }
	        var entry = {
	            id: id,
	            name: name,
	            parent: parent,
	            entries: isGroup ? [] : nil,
	            active: +isGroup,
	            start: start != nil ? start : perf.now(),
	            end: end != nil ? end : nil,
	            stop: isGroup ? stopGroup : stopEntry,
	        };
	        if (parent === nil) {
	            !disabled && entries.push(entry);
	        }
	        else if (parent.end !== nil && end == nil) {
	            warn("[timekeeper] Group \"" + parent.name + "\" is stopped");
	        }
	        else if (!disabled) {
	            parent.active++;
	            parent.entries.push(entry);
	        }
	        if (isGroup) {
	            entry.add = add;
	            entry.time = time;
	            entry.group = group;
	            entry.mark = groupMark;
	            !disabled && !isolate && activeGroups.unshift(entry);
	        }
	        else {
	            !disabled && activeEntries.push(entry);
	        }
	        !disabled && (start == nil) && perfSupported && perf[s_mark](id);
	        return entry;
	    }
	    function stopEntry(end) {
	        if (this.end === nil) {
	            this.end = end >= 0 ? end : perf.now();
	            (end == nil) && perfSupported && measure(this);
	            emit(this);
	            closeGroup(this.parent, end);
	        }
	        return this;
	    }
	    function stopGroup(end) {
	        groupStopAll(this);
	        closeGroup(this, end);
	        return this;
	    }
	    function closeGroup(entry, end) {
	        needPrint && print();
	        if (entry !== nil) {
	            if (entry.active > 0) {
	                (--entry.active === 0) && closeGroup(entry, end);
	            }
	            else if (entry.end === nil) {
	                var idx = activeGroups.indexOf(entry);
	                (idx > -1) && activeGroups.splice(idx, 1);
	                entry.end = end >= 0 ? end : perf.now();
	                (end == nil) && perfSupported && measure(entry);
	                emit(entry);
	                closeGroup(entry.parent, end);
	            }
	        }
	    }
	    function add(name, start, end) {
	        if (start >= 0 && start <= end) {
	            createEntry(name, this, false, start).stop(end);
	        }
	    }
	    function time(name, executer) {
	        var entry = createEntry(name, this, false);
	        if (executer != null) {
	            executer();
	            entry.stop();
	        }
	        else {
	            return entry;
	        }
	    }
	    function timeEnd(name) {
	        if (!disabled) {
	            var idx = activeEntries.length;
	            var entry = void 0;
	            while (idx--) {
	                entry = activeEntries[idx];
	                if (entry.name === name) {
	                    entry.stop();
	                    activeEntries.splice(idx, 1);
	                    return;
	                }
	            }
	            warn && warn("[timekeeper] Timer \"" + name + "\" doesn't exist");
	        }
	    }
	    function groupStopAll(group) {
	        var entries = group.entries;
	        var idx = entries.length;
	        while (idx--) {
	            entries[idx].stop();
	        }
	    }
	    function groupMark(name) {
	        groupStopAll(this);
	        this.time(name);
	    }
	    function group(name, start, isolate) {
	        if (start === true) {
	            isolate = start;
	            start = nil;
	        }
	        return createEntry(name, isolate ? nil : this, true, start, nil, isolate);
	    }
	    function groupEnd(name, end) {
	        for (var i = 0; i < activeGroups.length; i++) {
	            if (name == nil || activeGroups[i].name === name) {
	                activeGroups[i].stop(end);
	                return;
	            }
	        }
	        warn("[timekeeper] Group \"" + name + "\" not found");
	    }
	    // Public API
	    return (api = {
	        perf: perf,
	        entries: entries,
	        print: print,
	        disable: disable,
	        setAnalytics: setAnalytics,
	        add: add,
	        time: time,
	        timeEnd: timeEnd,
	        group: group,
	        groupEnd: groupEnd,
	    });
	}
	var system = globalThis.timekeeper ? globalThis.timekeeper.system : create({
	    print: /^(file:|https?:\/\/(localhost|artifact-project))/.test(globalThis.location + ''),
	    timeline: true,
	    prefix: '⚡️',
	});

	exports.color = color;
	exports.create = create;
	exports.system = system;

	return exports;

}({}));


		// Plugins

			// Timings: navigation
			var timekeeperTimingsNavigation=function(t){"use strict";var e=Function("return this")();function f(t){"complete"===e.document.readyState?t():window.addEventListener("DOMContentLoaded",t)}return t.navigationTimings=function(t){var a,i,d=(a="tk-navigation",i=t,function(t,e,n,o){var r=i.group(t?a+"-"+t:a,e,!0);o.forEach(function(t){r.add(t[0],t[1],t[2])}),r.stop(n)});try{var e=performance.timing,n=e.navigationStart,o=e.redirectStart,r=e.redirectEnd,c=e.fetchStart,m=e.domainLookupStart,s=e.domainLookupEnd,u=e.requestStart,p=e.responseStart,v=e.responseEnd;d("net",n,v,[["redirect",o,r],["app-cache",c,m],["dns",m,s],["tcp",s,u],["request",u,p],["response",p,v]])}catch(t){}f(function t(){try{var e=performance.timing,n=e.responseEnd,o=e.domInteractive,r=e.domContentLoadedEventEnd,a=e.domComplete;if(!a)return void setTimeout(t,250);d("dom-ready",n,a,[["interactive",n,o],["content-loaded",o,r],["complete",r,a]])}catch(t){}}),f(function t(){try{var e=performance.timing,n=e.responseEnd,o=e.domComplete,r=e.loadEventEnd;if(!r)return void setTimeout(t,250);d("dom-load",n,r,[["ready",n,o],["load",o,r]])}catch(t){}})},t}({});

			timekeeperTimingsNavigation.navigationTimings(timekeeper.system);


			// Timings: paint
			var timekeeperTimingsPaint=function(t){"use strict";var e=Function("return this")();return t.paintTimings=function(t){var a,o,n,i=(a="tk-paint",o=t,function(t,n,e,r){var i=o.group(t?a+"-"+t:a,n,!0);r.forEach(function(t){i.add(t[0],t[1],t[2])}),i.stop(e)});n=function t(){try{var n=performance.getEntriesByType("paint");if(1<n.length){var e=0,r=n.sort(function(t,n){return t.startTime-n.startTime}).map(function(t){var n=[t.name,e,t.startTime];return e=t.startTime,n});i(null,0,e,r)}else setTimeout(t,250)}catch(t){}},"complete"===e.document.readyState?n():window.addEventListener("DOMContentLoaded",n)},t}({});

			timekeeperTimingsPaint.paintTimings(timekeeper.system);


			// Timings: interactive
			var timekeeperTimingsInteractive=function(n){"use strict";var f=Function("return this")();var v={minLatency:100};function d(n,e,i){n.forEach(function(n){var t=function(){f.removeEventListener(n,t,!0),e(n)};(i=i||f).addEventListener(n,t,!0)})}return n.interactiveTimings=function(n,i){void 0===i&&(i=v);var r,c,t,o=(r="tk-interactive",c=n,function(n,t,e,i){var o=c.group(n?r+"-"+n:r,t,!0);i.forEach(function(n){o.add(n[0],n[1],n[2])}),o.stop(e)}),a=function(){return n.perf.now()},e=["click","touchup","submit","abort","blur","contextmenu","deviceorientation","offline","online","paint","popstate","resize","wheel","scroll"];function u(n,t,e,i){void 0===e&&(e=0),void 0===i&&(i=a()),o(n,e,i,[[t,e,i]])}d(e,function(n){u("first-"+n,"value")}),d(["beforeunload"],function(){u("tab-unload","value")}),["click","touchup","input","submit","resize","scroll"].forEach(function(t){var e;function n(){var n=a();n-e>=i.minLatency&&u("latency-"+t,"value",e,n)}f.addEventListener(t,function(){e=a(),requestAnimationFrame(n)},!0)}),t=function(){d(e,function(n){u("first-"+n,"after-ready")})},"complete"===f.document.readyState?t():window.addEventListener("DOMContentLoaded",t)},n}({});

			timekeeperTimingsInteractive.interactiveTimings(timekeeper.system);


		// Analytics
		const analytics = [];

			// Analytics: google
			var timekeeperAnalytics=function(e){"use strict";var r=Function("return this")(),u={useTabName:function(e){var n=e.pathname;return("/"===n?"index":n.substr(1)).replace(/[\/\.]+/g,"-")}};return e.googleAnalytics=function(n,a){void 0===a&&(a=u);var t=[],i=function(e){n?n("send",e):t.push(e)};return n||function e(){(n=r.gtag?function(e,n){r.gtag("event","timing_complete",{name:n.timingVar,value:n.timingValue,event_category:n.timingCategory,event_label:n.timingLabel})}:r.ga)?(t.forEach(i),t.length=0):setTimeout(e,500)}(),function(e){var n=e.name,t="value";if(e.parent)for(t=e.name;;){if(!(e=e.parent).parent){n=e.name;break}t=e.name+"_"+t}i({hitType:"timing",timingCategory:n,timingVar:t,timingValue:Math.round(e.end-e.start),timingLabel:a.useTabName?a.useTabName(r.location):void 0})}},e}({});

			analytics.push(timekeeperAnalytics.googleAnalytics());


		timekeeper.system.setAnalytics(analytics);

		</script>
	<script>
		var keeper = timekeeper.create({
			print: true,    // DevTools -> Console
			timeline: true, // DevTools -> Performance
			prefix: '⏱',
		});
		keeper.group('head');
	</script>

	<script>
		keeper.group('css');
		keeper.time('bootstrap');
	</script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<script>
		keeper.timeEnd('bootstrap');
		keeper.groupEnd('css');
	</script>

	<script>
		keeper.group('js');
		keeper.time('jquery');
	</script>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script>
		keeper.timeEnd('jquery');
		keeper.time('popper');
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	<script>
		keeper.timeEnd('popper');
		keeper.time('bootstrap');
	</script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	<script>
		keeper.timeEnd('bootstrap');
		keeper.groupEnd('js');
	</script>

	<script>keeper.groupEnd('head');</script>
</head>
<body>
	<script>
		keeper.group('body');
	</script>

	<br/>
	<br/>

	<div class="container">
		<h1>TimeKeeper Example</h1>
		<div>
			Open DevTools and see Console (after opening, click on the document).
		</div>
	</div>

	<script>

	</script>

	<script>
		keeper.groupEnd('body');

		const ginit = keeper.group('init', true);
		let timer = ginit.time('before');
		setTimeout(async () => {
			timer.stop();

			// Slow block
			await new Promise(r => setTimeout(r, 30));

			timer = ginit.time('after');
			setTimeout(() => {
				timer.stop();
				ginit.stop();
			}, 5);
		}, 10);

		const gapp = keeper.group('app', true);
		gapp.mark('boot');
		setTimeout(async () => {
			gapp.mark('route');
			// Slow block
			await new Promise(r => setTimeout(r, 30));

			gapp.mark('nav')
			setTimeout(() => {
				gapp.stop();
			}, 5);
		}, 10);


		document.addEventListener('click', () => {
			function fibonacci(num) {
				if (num <= 1) return 1;
				return fibonacci(num - 1) + fibonacci(num - 2);
			}

			keeper.time('fibonacci', () => {
				console.log('fibonacci:', fibonacci(25 + Math.random() * 15));
			});
		});
	</script>
</body>
</html>